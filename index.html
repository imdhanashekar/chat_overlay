<!DOCTYPE html>
<html>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chat</title>
    <link rel="stylesheet" href="assets/styles/main.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Nunito:wght@900&display=swap">
    <script>
        const loadParams = new URLSearchParams(window.location.search);

        // Função para carregar um script e retornar uma Promise
        function loadScript(src) {
            return new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.src = src;
                script.onload = () => resolve();
                script.onerror = () => reject(new Error(`Falha ao carregar ${src}`));
                document.head.appendChild(script);
            });
        }

        // Verificação de parâmetros para YouTube com detecção automática
        const hasYouTubeParams = (() => {
            const possibleParams = ["handle", "id", "channelId", "value"]; // "value" como fallback opcional
            for (const paramName of possibleParams) {
                const rawParam = loadParams.get(paramName);
                if (rawParam) {
                    if (rawParam.startsWith("UC") && rawParam.length === 24) {
                        return true; // Channel ID do YouTube
                    } else if (rawParam.startsWith("@")) {
                        return true; // Handle do YouTube
                    } else if (rawParam.length === 11 && /^[A-Za-z0-9\-_]+$/.test(rawParam)) {
                        return true; // Video ID do YouTube
                    }
                }
            }
            return loadParams.has("handle") || loadParams.has("id") || loadParams.has("channelId");
        })();

        // Verificação de parâmetros para Twitch
        const hasTwitchParams = (() => {
            const twitchParam = loadParams.get("twitch") || loadParams.get("channel");
            return twitchParam && loadParams.has("token");
        })();

        // Verificação de parâmetros para Kick (sem alterações)
        const hasKickParams = loadParams.has("kick");

        // Carregar scripts do YouTube se os parâmetros existirem
        if (hasYouTubeParams) {
            loadScript("assets/scripts/platforms/youtube.js")
                .then(() => console.log("YouTube script loaded."))
                .catch(err => console.error(err));
        }

        // Carregar scripts do Twitch se os parâmetros existirem
        if (hasTwitchParams) {
            const twitchDependencies = [
                "assets/scripts/dependencies/jquery.min.js",
                "assets/scripts/dependencies/irc-message.js",
                "assets/scripts/dependencies/reconnecting-websocket.min.js",
                "assets/scripts/dependencies/twemoji.min.js",
                "assets/scripts/dependencies/tinycolor.js"
            ];
            const twitchMainScript = "assets/scripts/platforms/twitch.js";

            // Carregar todas as dependências em sequência
            twitchDependencies.reduce((promise, src) => {
                return promise.then(() => loadScript(src));
            }, Promise.resolve())
                .then(() => loadScript(twitchMainScript)) // Carregar twitch.js apenas após as dependências
                .then(() => console.log("Twitch scripts loaded."))
                .catch(err => console.error(err));
        }

        // Carregar scripts do Kick se os parâmetros existirem
        if (hasKickParams) {
            loadScript("assets/scripts/platforms/kick.js")
                .then(() => console.log("Kick script loaded."))
                .catch(err => console.error(err));
        }

        // Se nenhum parâmetro for fornecido
        if (!hasYouTubeParams && !hasTwitchParams && !hasKickParams) {
            console.log("No scripts loaded.");
        }
    </script>
</head>

<body>
    <div id="chat"></div>
</body>

</html>